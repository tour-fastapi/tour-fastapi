<!doctype html>
<html lang="en" data-theme="default">
<head>
  <meta charset="utf-8" />

  {# =========================================================
     SEO (AUTO in base.html)
     - Computes title + description by URL
     - Adds:
       <title>
       <meta name="title">
       <meta name="description">
       OG + Twitter
     ========================================================= #}

  {% set path = request.url.path if request and request.url else "" %}
  {% set canonical_url = (request.url|string) if request and request.url else "" %}

  {# defaults #}
  {% set final_title = "Umrah Advisor" %}
  {% set final_description = "Discover verified Umrah operators and Umrah packages across cities." %}

  {# /packages (package_list.html) #}
  {% if path == "/packages" %}
    {% set final_title = "Find Your Perfect Umrah Package" %}
    {% if packages_by_city %}
      {% set final_description = "Discover Umrah packages by city" %}
    {% else %}
      {% set final_description = "No packages available yet" %}
    {% endif %}

  {# /operators (operator_list.html) #}
  {% elif path == "/operators" %}
    {% set final_title = "Umrah Tour Operators" %}
    {% set final_description = "Browse trusted and verified Umrah tour operators across India" %}

  {# /city/{city}/packages (package_city.html) #}
  {% elif path.startswith("/city/") and path.endswith("/packages") %}
    {% if city is defined %}
      {% set final_title = "Umrah Packages in " ~ city %}
      {% if count is defined %}
        {% set final_description = count ~ " Umrah package" ~ ("s" if count != 1 else "") ~ " departing from " ~ city %}
      {% else %}
        {% set final_description = "Umrah packages departing from " ~ city %}
      {% endif %}
    {% endif %}

  {# /city/{city}/operators (opeartor_by_city.html) #}
  {% elif path.startswith("/city/") and path.endswith("/operators") %}
    {% if city is defined %}
      {% set final_title = "Umrah Operators in " ~ city %}
      {% if count is defined %}
        {% set final_description = count ~ " Verified Umrah operator" ~ ("s" if count != 1 else "") ~ " serving in " ~ city %}
      {% else %}
        {% set final_description = "Verified Umrah tour operators serving " ~ city %}
      {% endif %}
    {% endif %}
  {% endif %}

  {# Optional: noindex for package detail pages #}
  {% set is_package_detail = (path.startswith("/packages/") and path != "/packages") %}

  <title>{{ final_title }}</title>

  <!-- SEO Meta -->
  <meta name="title" content="{{ final_title }}">
  <meta name="description" content="{{ final_description }}">
  {% if canonical_url %}
    <link rel="canonical" href="{{ canonical_url }}">
  {% endif %}

  {% if is_package_detail %}
    <meta name="robots" content="noindex, nofollow">
  {% endif %}

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ final_title }}">
  <meta property="og:description" content="{{ final_description }}">
  {% if canonical_url %}<meta property="og:url" content="{{ canonical_url }}">{% endif %}

  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="{{ final_title }}">
  <meta name="twitter:description" content="{{ final_description }}">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="{{ url_for('static', path='favicon.ico') }}">
  <link rel="stylesheet" href="/static/css/styles.css">
</head>

<body>

  <header class="site-header">
    <div class="site-header__container">

      <div class="site-header__row">
        <a href="/" class="site-logo">
          <div class="site-logo__icon">U</div>
          <span class="site-logo__text">Umrah Advisor</span>
        </a>

        <div class="site-search is-hidden">
          <svg class="site-search__icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
          <input
            type="search"
            class="site-search__input"
            placeholder="Search packages, destinations..."
            aria-label="Search packages and destinations"
          />
        </div>

        <div class="site-header__actions">
          <div class="">
            {% set auth_pages = ['/login', '/register', '/forgot-password', '/reset-password', '/verify'] %}

            {% if user %}
              <div class="user-menu">
                {% if is_admin %}
                  <button class="btn-outline">Admin</button>
                  <span class="nav-link disabled" aria-disabled="true" title="Admin accounts don't use agency dashboard">Dashboard</span>
                {% else %}
                  {% if nav_agency %}
                    <a href="/agency/{{ nav_agency.registration_id }}/dashboard" class="btn-text">Dashboard</a>
                  {% else %}
                    <a href="/select-agency" class="btn-outline btn-outline-secondary">Dashboard</a>
                  {% endif %}
                {% endif %}

                <div class="user-menu__avatar">J</div>
                <span class="user-menu__name">John Doe</span>

                <form method="post" action="/logout" class="d-inline">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                  <button class="btn-text">Logout</button>
                </form>
              </div>
            {% else %}
              {% if path not in auth_pages %}
                <a href="/login" class="btn-text">Login</a>
                <a href="/register" class="btn-primary">Get Started</a>
              {% endif %}
            {% endif %}
          </div>
        </div>

      </div>

      <div class="site-search-mobile is-hidden">
        <svg class="site-search-mobile__icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input
          type="search"
          class="site-search-mobile__input"
          placeholder="Search packages, destinations..."
          aria-label="Search packages and destinations"
        />
      </div>

    </div>
  </header>

  {% if flashes %}
    <div class="container mt-3">
      {% for f in flashes %}
        <div class="alert alert-{{ 'danger' if f.type == 'error' else f.type }} alert-dismissible fade show" role="alert">
          {{ f.text }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <main class="">
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <div class="site-footer__container">

      {% if footer_cities %}
        <div class="footer-seo">
          <div class="footer-seo__grid">
            <div>
              <h3 class="footer-seo__heading">Umrah Operators by City</h3>
              <ul class="footer-seo__links">
                {% for c in footer_cities %}
                  <li class="footer-seo__link"><a href="{{ c.operators_href }}">Umrah operators in {{ c.name }}</a></li>
                {% endfor %}
              </ul>
            </div>

            <div>
              <h3 class="footer-seo__heading">Umrah Packages by City</h3>
              <ul class="footer-seo__links">
                {% for c in footer_cities %}
                  <li><a href="{{ c.packages_href }}" class="footer-seo__link">Umrah packages in {{ c.name }}</a></li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      {% endif %}

      <div class="footer-bottom">
        <div class="footer-section">
          <a href="/" class="footer-logo">
            <div class="footer-logo__icon">U</div>
            <span class="footer-logo__text">Umrah Advisor</span>
          </a>
          <p class="footer-about">
            Your trusted platform for finding the perfect Umrah packages from verified operators worldwide.
          </p>
          <p class="footer-copyright mt-2">
            Â© 2026 Umrah Advisor. All rights reserved.
          </p>
        </div>
      </div>

    </div>
  </footer>

  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script>
    lucide.createIcons();
  </script>

</body>
</html>
