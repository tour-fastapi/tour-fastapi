{% extends "base.html" %}
{% block content %}
<div class="container py-4" style="max-width: 820px;">
  <h1 class="h4 mb-3">Add Package</h1>

  {% if flashes %}
    {% for f in flashes %}
      <div class="alert alert-{{ 'danger' if f.type == 'error' else f.type }} alert-dismissible fade show" role="alert">
        {{ f.text }}
        <button type="button" class="btn btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" action="/package/new" class="card p-3">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="agency_id" value="{{ agency.registration_id }}">


    <div class="mb-3">
      <label class="form-label d-block">Package Type *</label>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="package_type" id="type_haj" value="haj" required>
        <label class="form-check-label" for="type_haj">Haj</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="package_type" id="type_umrah" value="umrah" required>
        <label class="form-check-label" for="type_umrah">Umrah</label>
      </div>
      <div class="form-text">Choose exactly one.</div>
    </div>

    <!-- Basics -->
    <div class="mb-3">
      <label class="form-label">Package name *</label>
      <input class="form-control" type="text" name="package_name" required>
    </div>


    <div class="mb-3">
      <label class="form-label">Package Class</label>
      <select class="form-select" name="package_class">
        <option value="">-- select class (optional) --</option>
        <option value="economy">Economy</option>
        <option value="business">Business</option>
        <option value="first">First Class</option>
      </select>
      <div class="form-text">Choose the cabin/service class for this package.</div>
    </div>


    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Number of Days *</label>
        <input class="form-control" type="number" name="days" min="1" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Base Price (₹) *</label>
        <input class="form-control" type="number" step="0.01" name="price" min="0" required>
      </div>
      <div class="col-md-12">
        <label class="form-label">Variant prices</label>
        <div class="row g-2">
          <div class="col-md-4">
            <input class="form-control" type="number" step="0.01" name="price_double" placeholder="Double / Couple price">
          </div>
          <div class="col-md-4">
            <input class="form-control" type="number" step="0.01" name="price_triple" placeholder="Triple price">
          </div>
          <div class="col-md-4">
            <input class="form-control" type="number" step="0.01" name="price_quad" placeholder="Quad/Quint price">
          </div>
        </div>
        <input class="form-control mt-2" type="text" name="price_note" placeholder="Note / label (optional)">
      </div>
    </div>

    <div class="mb-3 mt-3">
      <label class="form-label">Description</label>
      <textarea class="form-control" name="description" rows="3" placeholder="Add additional notes or conditions"></textarea>
    </div>


    
    <!-- NEW: Travel Month & Year (right below Description) -->
    <div class="row g-3 mb-3">
      <div class="col-md-6">
        <label class="form-label">Travel Month</label>
        <select class="form-select" name="travel_month">
          <option value="">-- select month --</option>
          {% set month_names = ['January','February','March','April','May','June','July','August','September','October','November','December'] %}
          {% for i in range(1, 13) %}
            <option value="{{ i }}">{{ month_names[i-1] }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Pick the month pilgrims will travel.</div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Travel Year</label>
        <select class="form-select" name="travel_year">
          <option value="">-- select year --</option>
          {% for y in years %}
            <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Only years ≥ 2026 are listed.</div>
      </div>
    </div>


    <div class="mb-3">
      <label class="form-label">Airlines (you can select multiple)</label>
      <select class="form-select" name="airline_ids" multiple size="6">
        {% for a in airlines %}
          <option value="{{ a.airline_id }}">{{ a.name }}</option>
        {% endfor %}
      </select>
      <div class="form-text">Hold Ctrl/Cmd to multi-select (desktop).</div>
    </div>



    <hr class="my-4">

    <!-- Flights -->
    <h2 class="h6 mb-3">Flights</h2>
    <div class="row">
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h3 class="h6">Onward</h3>
            <div class="mb-2">
              <label class="form-label">Date</label>
              <input class="form-control" type="date" name="onward_date">
            </div>
            <div class="mb-2">
              <label class="form-label">Type</label>
              <select class="form-select" name="onward_type">
                <option value="">-- select --</option>
                <option value="direct">Direct</option>
                <option value="via">Via</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Via (if any)</label>
              <input class="form-control" type="text" name="onward_via" placeholder="e.g., Doha">
            </div>
            <div class="mb-2">
              <label class="form-label">Airline</label>
              <input class="form-control" type="text" name="onward_airline" placeholder="e.g., Qatar Airways">
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h3 class="h6">Return</h3>
            <div class="mb-2">
              <label class="form-label">Date</label>
              <input class="form-control" type="date" name="return_date">
            </div>
            <div class="mb-2">
              <label class="form-label">Type</label>
              <select class="form-select" name="return_type">
                <option value="">-- select --</option>
                <option value="direct">Direct</option>
                <option value="via">Via</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Via (if any)</label>
              <input class="form-control" type="text" name="return_via" placeholder="e.g., Muscat">
            </div>
            <div class="mb-2">
              <label class="form-label">Airline</label>
              <input class="form-control" type="text" name="return_airline" placeholder="e.g., Oman Air">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stays -->
    <h2 class="h6 mb-3">Stay</h2>
    <div class="row">
      <!-- Mecca -->
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h3 class="h6">Mecca</h3>
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Check-in</label>
                <input class="form-control" type="date" name="mecca_check_in">
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Check-out</label>
                <input class="form-control" type="date" name="mecca_check_out">
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">Hotel name</label>
              <input class="form-control" type="text" name="mecca_hotel" list="hotels_list" placeholder="Start typing…">
            </div>
            <div class="mb-2">
              <label class="form-label">Hotel link (optional)</label>
              <input class="form-control" type="url" name="mecca_link" placeholder="https://">
            </div>

            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Distance (meters)</label>
                <input class="form-control" type="number" name="mecca_distance_m" min="0" placeholder="e.g., 300">
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Distance label</label>
                <input class="form-control" type="text" name="mecca_distance_text" placeholder="e.g., 300 m from Haram">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Medinah -->
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h3 class="h6">Medinah</h3>
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Check-in</label>
                <input class="form-control" type="date" name="med_check_in">
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Check-out</label>
                <input class="form-control" type="date" name="med_check_out">
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">Hotel name</label>
              <input class="form-control" type="text" name="med_hotel" list="hotels_list" placeholder="Start typing…">
            </div>
            <div class="mb-2">
              <label class="form-label">Hotel link (optional)</label>
              <input class="form-control" type="url" name="med_link" placeholder="https://">
            </div>

            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Distance (meters)</label>
                <input class="form-control" type="number" name="med_distance_m" min="0" placeholder="e.g., 500">
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Distance label</label>
                <input class="form-control" type="text" name="med_distance_text" placeholder="e.g., 500 m from Masjid an-Nabawi">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Shared datalist for hotel suggestions -->
    <datalist id="hotels_list">
      {% for h in hotels %}
        <option value="{{ h.name }}">{{ h.link or '' }}</option>
      {% endfor %}
    </datalist>

    <!-- Inclusions -->
    <h2 class="h6 mb-3">Inclusions</h2>
    <div class="card mb-3">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_meals_enabled" name="incl_meals_enabled">
              <label class="form-check-label fw-semibold" for="incl_meals_enabled">Meals</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_meals_desc" placeholder="e.g., Breakfast & Dinner">
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_laundry_enabled" name="incl_laundry_enabled">
              <label class="form-check-label fw-semibold" for="incl_laundry_enabled">Laundry</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_laundry_desc" placeholder="e.g., Alternate days">
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_transport_enabled" name="incl_transport_enabled">
              <label class="form-check-label fw-semibold" for="incl_transport_enabled">Transport</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_transport_desc" placeholder="e.g., Airport transfers + Ziyarat">
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_zamzam_enabled" name="incl_zamzam_enabled">
              <label class="form-check-label fw-semibold" for="incl_zamzam_enabled">Zam Zam</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_zamzam_desc" placeholder="e.g., 5 liters per pilgrim">
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_welcome_kit_enabled" name="incl_welcome_kit_enabled">
              <label class="form-check-label fw-semibold" for="incl_welcome_kit_enabled">Welcome Kit</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_welcome_kit_desc" placeholder="e.g., Backpack, ID card, prayer mat">
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="incl_insurance_enabled" name="incl_insurance_enabled">
              <label class="form-check-label fw-semibold" for="incl_insurance_enabled">Insurance</label>
            </div>
            <input class="form-control mt-2" type="text" name="incl_insurance_desc" placeholder="e.g., Travel medical insurance included">
          </div>

          <div class="col-12">
            <label class="form-label mt-2">Other notes (optional)</label>
            <textarea class="form-control" name="incl_other" rows="2" placeholder="(optional — add any other inclusions or notes)"></textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary" type="submit">Save & Next</button>
      <a href="/agency/{{ agency.registration_id }}/dashboard" class="btn btn-outline-secondary">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
