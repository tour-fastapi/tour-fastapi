{% extends "base.html" %}
{% block title %}Discover Packages{% endblock %}
{% block content %}
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --text:#0f172a; --muted:#64748b;
    --primary:#2563eb; --primary-600:#1d4ed8; --border:#e5e7eb;
    --radius:16px; --shadow:0 12px 32px rgba(2,6,23,.08);
  }
  body{background:var(--bg);}
  .page{max-width:1100px;margin:28px auto;padding:0 16px}

  /* Hero */
  .hero{background:linear-gradient(180deg,#ffffff, #f8fafc);border:1px solid var(--border);
        border-radius:20px;box-shadow:var(--shadow);padding:26px 20px;margin-bottom:18px}
  .hero h1{margin:0 0 6px 0;font-size:1.8rem;font-weight:900;color:var(--text);letter-spacing:.2px}
  .hero p{margin:0;color:var(--muted);font-size:1rem}
  .pill{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;
        border-radius:999px;padding:6px 12px;font-size:.8rem;font-weight:700}

  /* Section */
  .section{margin:22px 0}
  .section-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .section-title{margin:0;font-size:1.25rem;font-weight:800;color:var(--text)}
  .section-meta{color:var(--muted);font-size:.92rem}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:14px}
  @media (max-width: 980px){ .grid{grid-template-columns:repeat(2,1fr);} }
  @media (max-width: 680px){ .grid{grid-template-columns:1fr;} }

  /* Package card (full clickable) */
  .pkg{display:block;text-decoration:none;background:#fff;border:1px solid var(--border);border-radius:14px;overflow:hidden;
       transition:box-shadow .2s,border-color .2s,transform .08s}
  .pkg:hover{border-color:#c7d2fe;box-shadow:0 16px 42px rgba(37,99,235,.12);transform:translateY(-1px)}
  .pkg-media{height:140px;background:linear-gradient(135deg,#e2e8f0,#dbeafe)}
  .pkg-body{padding:14px}
  .pkg-name{margin:0 0 6px 0;font-size:1.05rem;font-weight:800;color:var(--text);line-height:1.3}
  .pkg-sub{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:6px}
  .chip{display:inline-block;padding:4px 10px;border:1px solid var(--border);border-radius:999px;font-size:.8rem;color:#334155;background:#fff}
  .pkg-desc{color:#0f172a;font-size:.95rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  .pkg-foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:.92rem}
  .price{font-weight:900;color:#0f172a}
  .cta{color:var(--primary);font-weight:700}
  .empty{padding:40px;text-align:center;color:var(--muted)}
</style>

<div class="page">

  <!-- Hero -->
  <div class="hero">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <h1>Discover Packages</h1>
        <p>Hand-picked packages grouped by city. Click any card to see details.</p>
      </div>
      <div class="pill">{{ packages_by_city|length }} cities</div>
    </div>
  </div>

  {% if packages_by_city and packages_by_city|length > 0 %}
    {% for city, items in packages_by_city %}
      <section class="section">
        <div class="section-head">
          <h2 class="section-title">{{ city }}</h2>

          <div class="section-meta">{{ items|length }} package{{ 's' if items|length != 1 else '' }}</div>
        </div>

        <div class="card">
              <div style="padding:0 14px 14px">
                  <a href="/city/{{ city|urlencode }}/packages" style="text-decoration:none;color:#2563eb">
                    View all packages in {{ city }} →
                  </a>

              </div>
          <div class="grid">
            {% for p in items %}
              {% set ag = agency_by_id.get(p.registration_id) %}
              {% set href = "/packages/" ~ p.package_id %}


              <a class="pkg" href="{{ href }}">
                <!-- image / banner (placeholder gradient) -->
                <div class="pkg-media"></div>
                

                <div class="pkg-body">
                  <h3 class="pkg-name">{{ p.package_name }}</h3>
                  

                  <div class="pkg-sub">
                    {% if p.days %}<span class="chip">{{ p.days }} day{{ 's' if p.days != 1 else '' }}</span>{% endif %}
                    {% if p.price is not none %}<span class="chip">₹ {{ '%0.2f'|format(p.price) }}</span>{% endif %}
                    {% if ag and ag.agencies_name %}<span class="chip">{{ ag.agencies_name }}</span>{% endif %}
                    {% if ag and ag.country %}<span class="chip">{{ ag.country }}</span>{% endif %}
                  </div>

                  {% if p.description %}
                    <div class="pkg-desc">{{ p.description }}</div>
                  {% endif %}

                  <div class="pkg-foot">
                    <div>{{ ag.city if ag and ag.city else '—' }}, {{ ag.country if ag and ag.country else '—' }}</div>
                    <div class="cta">View details →</div>
                  </div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      </section>
    {% endfor %}
    
  {% else %}
    <div class="card empty">No packages available yet.</div>
  {% endif %}
</div>

{% endblock %}
