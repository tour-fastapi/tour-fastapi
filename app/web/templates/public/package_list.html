{% extends "base.html" %}
{% block title %}Discover Packages{% endblock %}
{% block content %}


<main class="page">

  <!-- Hero -->
  <header class="page-header">
    <div class="page-title-wrap">
      <div class="page-title-group">
        <h1 class="page-title">
          Umrah Packages by City
        </h1>

        <p class="page-subtitle">
          Discover Umrah packages offered by verified tour operators
        </p>
      </div>

      <span class="page-count">
        {{ packages_by_city|length }}
        cit{{ 'ies' if packages_by_city|length != 1 else 'y' }}
      </span>
    </div>
  </header>

  {% if packages_by_city and packages_by_city|length > 0 %}
    {% for city, items in packages_by_city %}
      <section class="section">
        <div class="group-header">
          <h2 class="group-title">{{ city }}</h2>
          <span class="group-count">
            {{ items|length }}
            package{{ 's' if items|length != 1 else '' }}
          </span>
        </div>

        <div class="card">
              <div style="padding:0 14px 14px">
                {% if city != 'Unknown' %}
                <a href="/city/{{ city|urlencode }}/umrah_packages" style="text-decoration:none;color:#2563eb">
                  View all packages in {{ city }} →
                </a>
                {% endif %}
              </div>

          <div class="grid">
            {% for p in items %}
              {% set ag = agency_by_id.get(p.registration_id) %}
              {% set href = "/umrah_packages/" ~ p.package_id %}


              <a class="pkg" href="{{ href }}">
                <!-- image / banner (placeholder gradient) -->
                <div class="pkg-media"></div>
                

                <div class="pkg-body">
                  <h3 class="pkg-name">{{ p.package_name }}</h3>
                  

                  <div class="pkg-sub">
                    {% if p.days %}<span class="chip">{{ p.days }} day{{ 's' if p.days != 1 else '' }}</span>{% endif %}
                    {% if p.price is not none %}<span class="chip">₹ {{ '%0.2f'|format(p.price) }}</span>{% endif %}
                    {% if ag and ag.agencies_name %}<span class="chip">{{ ag.agencies_name }}</span>{% endif %}
                    {% if ag and ag.country %}<span class="chip">{{ ag.country }}</span>{% endif %}
                  </div>

                  {% if p.description %}
                    <div class="pkg-desc">{{ p.description }}</div>
                  {% endif %}

                  <div class="pkg-foot">
                    <div>{{ ag.city if ag and ag.city else '—' }}, {{ ag.country if ag and ag.country else '—' }}</div>
                    <div class="cta">View details →</div>
                  </div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      </section>
    {% endfor %}
    
  {% else %}
    <div class="card empty">No packages available yet.</div>
  {% endif %}
    </main>

{% endblock %}
