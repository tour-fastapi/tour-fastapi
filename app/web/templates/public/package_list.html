{% extends "base.html" %}
{% block title %}Discover Packages{% endblock %}
{% block content %}
{% import "shared/_macros.html" as ui %}


<main class="page">

  <!-- Hero -->
  <header class="page-header">
    <div class="page-title-wrap">
      <div class="page-title-group">
        <h1 class="page-title">
          Umrah Packages by City
        </h1>

        <p class="page-subtitle">
          Discover Umrah packages offered by verified tour operators
        </p>
      </div>

      <span class="page-count">
        {{ packages_by_city|length }}
        cit{{ 'ies' if packages_by_city|length != 1 else 'y' }}
      </span>
    </div>
  </header>

  {% if packages_by_city and packages_by_city|length > 0 %}
    {% for city, items in packages_by_city %}
      <section class="section">
        <div class="group-header">
          <h2 class="group-title">{{ city }}</h2>
          <span class="group-count">
            {{ items|length }}
            package{{ 's' if items|length != 1 else '' }}
          </span>
        </div>

        
              
          <section class="package-list">
            {% for p in items %}
              {% set ag = agency_by_id.get(p.registration_id) %}
              {% set href = "/umrah_packages/" ~ p.package_id %}


              <a class="package-card entity-card" href="{{ href }}">
                <!-- image / banner (placeholder gradient) -->
                 <div
                  class="package-avatar operator-avatar is is-hidden"
                  data-tone="{{ (loop.index0 + (ag.agencies_name|length if ag else 0)) % 12 }}"
                >
                  {% if ag %}
                    {{ ui.agency_badge(ag, 56, True) }}
                  {% endif %}
                </div>
                <div class="package-body">
    {% set banner = (p.banner_image or "dynamic-tawaf-at-night.jpg") %}
<div class="package-banner">
  <img
    src="/media/packages-banners/{{ banner }}"
    alt="{{ p.package_name }}"
    loading="lazy"
    onerror="this.onerror=null;this.src='/media/packages-banners/larger-ones/dynamic-tawaf-at-night.jpg';"
  />
</div>


    <!-- Top row: title + price -->
    <div class="package-top">
      <div class="package-top__left">
        <div class="package-title-row">
          <h2 class="package-name">{{ p.package_name }}</h2>

          <!-- Nudges next to title -->
          <div class="package-nudges-inline">
            <span class="nudge nudge--good">Refundable</span>
            <span class="nudge nudge--warn">Filling fast</span>
            <!-- only render 1â€“2 usually -->
          </div>
        </div>

        <div class="package-route-line">
          <span class="package-route">Mumbai â†’ Jeddah â†’ Mumbai</span>
          <span class="meta-sep">â€¢</span>
          <span class="package-duration">10D / 9N</span>
        </div>
      </div>


      <div class="package-price">
        <div class="package-price__value">â‚¹ 45,000</div>
        <div class="package-price__label">Starting</div>
      </div>
    </div>

   

    

    <!-- Chips / inclusions -->
    <div class="package-meta">
      <span class="meta-chip">Direct Flight</span>
      <span class="meta-chip">Visa Included</span>
      <span class="meta-chip">Transfers</span>
      <span class="meta-chip">Breakfast</span>
    </div>

    
    <div class="package-rows">
      <!-- Onward -->
      <div class="package-row">
        <div class="package-row__label">Onward</div>
        <div class="package-row__main">
          <div class="package-row__icon" aria-hidden="true">âœˆï¸</div>
          <div class="package-row__content">
            
            <div class="package-row__title">Saudia â€¢ 12 Jan 2026</div>
            <div class="package-row__meta">BOM â†’ JED â€¢ Direct</div>
          </div>
        </div>  
      </div>

      <!-- Return -->
      <div class="package-row">
        <div class="package-row__label">Return</div>
        <div class="package-row__main">
          <div class="package-row__icon" aria-hidden="true">ğŸ›¬</div>
          <div class="package-row__content">
            
            <div class="package-row__title">Air India â€¢ 22 Jan 2026</div>
            <div class="package-row__meta">JED â†’ BOM â€¢ Via DEL</div>
          </div>
        </div>  
      </div>

      <!-- Operator -->
      <div class="package-row">
        <div class="package-row__label">Operator</div>
        <div class="package-row__main">

          <div class="package-row__icon" aria-hidden="true">ğŸ·ï¸</div>
          <div class="package-row__content">
            
            <div class="package-row__title">Al Abaya</div>
            <div class="package-row__meta">â˜…â˜…â˜…â˜…â˜… 4.6 (120)</div>
          </div>
        </div>  
      </div>
    </div>




    <!-- Stay blocks -->
     <div class="package-stays is-hidden">
      <!-- Stay in Makkah -->
      <div class="stay-card">
        <div class="stay-thumb">M</div>

        <div class="stay-body">
          <div class="stay-label">Stay in Makkah</div>

          <div class="stay-primary">
            <span class="stay-hotel">Anjum Hotel</span>
            <span class="meta-sep">â€¢</span>
            <span class="stay-nights">6 nights</span>
          </div>

          <div class="stay-sub">0.6 km from Haram</div>
        </div>
      </div>

      <!-- Stay in Madinah -->
      <div class="stay-card">
        <div class="stay-thumb">D</div>

        <div class="stay-body">
          <div class="stay-label">Stay in Madinah</div>

          <div class="stay-primary">
            <span class="stay-hotel">Province Al Sham</span>
            <span class="meta-sep">â€¢</span>
            <span class="stay-nights">3 nights</span>
          </div>

          <div class="stay-sub">0.4 km from Masjid Nabawi</div>
        </div>
      </div>
    </div>

    


    <!-- Description -->
    {% if p.description %}
    <p class="package-description is-hidden">
      {{ p.description }}
    </p>
  {% endif %}

   

  </div>

                
              </a>
            {% endfor %}
            </section>
        
        <div style="padding:0 14px 14px">
                {% if city != 'Unknown' %}
                <a href="/city/{{ city|urlencode }}/umrah_packages" style="text-decoration:none;color:#2563eb">
                  View all packages in {{ city }} â†’
                </a>
                {% endif %}
              </div>

      </section>
    {% endfor %}
    
  {% else %}
    <div class="card empty">No packages available yet.</div>
  {% endif %}
    </main>

{% endblock %}
