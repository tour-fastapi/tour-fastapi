{% extends "base.html" %}
{% block title %}Browse by City{% endblock %}
{% block content %}
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --text:#111827; --muted:#6b7280;
    --primary:#2563eb; --primary-600:#1d4ed8; --border:#e5e7eb;
    --radius:16px; --shadow:0 10px 28px rgba(17,24,39,.08);
  }
  body{background:var(--bg);}
  .page{max-width:1100px;margin:28px auto;padding:0 16px}
  .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  .head h1{margin:0;font-size:1.6rem;font-weight:800;color:var(--text)}
  .badge{background:linear-gradient(135deg, var(--primary), var(--primary-600));color:#fff;border-radius:999px;padding:6px 10px;font-size:.8rem;font-weight:700}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:14px}
  @media (max-width: 980px){ .grid{grid-template-columns:repeat(2,1fr);} }
  @media (max-width: 680px){ .grid{grid-template-columns:1fr;} }

  /* City card (entire card is a link) */
  .city{position:relative;display:block;text-decoration:none;background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;transition:box-shadow .2s,border-color .2s,transform .08s}
  .city:hover{border-color:#c7d2fe;box-shadow:0 14px 38px rgba(37,99,235,.12);transform:translateY(-1px)}
  .city-name{margin:0 0 6px 0;font-weight:800;color:var(--text);font-size:1.1rem}
  .city-meta{color:var(--muted);font-size:.92rem}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;font-size:.78rem;color:#374151;background:#fff}
  .nores{padding:40px;text-align:center;color:var(--muted)}
</style>

<div class="page">
  <div class="head">
    <h1>Browse by City</h1>
    <div class="badge">
      {{ agencies|groupby('city')|list|length }} cities
    </div>
  </div>

  <div class="card">
    {# group agencies by city; sort groups by city name Aâ†’Z #}
    {% set groups = agencies|groupby('city')|list %}
    {% set groups = groups|sort(attribute='grouper') %}

    {% if groups and groups|length > 0 %}
      <div class="grid">
        {% for g in groups %}
          {% set city = g.grouper or 'Unknown' %}
          {% set items = g.list %}
          <a class="city" href="/city/{{ city|urlencode }}">
            <div class="city-name">{{ city }}</div>
            <div class="city-meta">
              {{ items|length }} operator{{ 's' if items|length != 1 else '' }}
            </div>
            {# show a few agency names as chips for flavor #}
            <div class="chips">
              {% for a in items[:3] %}
                <span class="chip">{{ a.agencies_name }}</span>
              {% endfor %}
              {% if items|length > 3 %}
                <span class="chip">+{{ items|length - 3 }} more</span>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="nores">No operators available yet.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
