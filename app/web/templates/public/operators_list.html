{% extends "base.html" %}
{% block title %}All Operators by City{% endblock %}

{% block content %}
{# version: operators_list v4 (no jinja groupby) #}
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --text:#0f172a; --muted:#64748b;
    --primary:#2563eb; --primary-600:#1d4ed8; --border:#e5e7eb;
    --radius:16px; --shadow:0 12px 32px rgba(2,6,23,.08);
  }
  body{background:var(--bg);}
  .wrap{max-width:1100px;margin:28px auto;padding:0 16px}

  .head{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:16px}
  .head h1{margin:0;font-size:1.6rem;font-weight:900;color:var(--text)}
  .pill{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;border-radius:999px;padding:6px 12px;font-size:.8rem;font-weight:700}

  .section{margin-top:22px}
  .section-title{margin:0 0 10px 0;font-size:1.25rem;font-weight:800;color:var(--text)}

  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
  .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:14px}
  @media (max-width: 980px){ .grid3{grid-template-columns:repeat(2,1fr);} }
  @media (max-width: 680px){ .grid3{grid-template-columns:1fr;} }

  .agency{border:1px solid var(--border);border-radius:14px;padding:14px;background:#fff;transition:box-shadow .2s,border-color .2s,transform .08s}
  .agency:hover{border-color:#c7d2fe;box-shadow:0 16px 42px rgba(37,99,235,.12);transform:translateY(-1px)}
  .agency h3{margin:0 0 6px 0;font-size:1.12rem}
  .agency h3 a{text-decoration:none;color:#111827}
  .agency h3 a:hover{color:var(--primary)}
  .meta{color:#6b7280;font-size:.92rem}
  .desc{margin-top:8px;color:#1f2937;font-size:.95rem}
  .muted{color:var(--muted)}
  .empty{padding:36px;text-align:center;color:var(--muted)}
</style>

<div class="wrap">
  <div class="head">
    <h1>Operators by City</h1>
    <div class="pill">
      {{ total }} operator{{ 's' if total != 1 else '' }} •
      {{ cities|length }} cit{{ 'ies' if cities|length != 1 else 'y' }}
    </div>
  </div>

  {% if cities and cities|length > 0 %}
    {% for group in cities %}
      <div class="section">
        <h2 class="section-title">
          Operators in {{ group.city }} <span class="muted">({{ group.agencies|length }})</span>
        </h2>
        <div class="card">
          {% if group.agencies and group.agencies|length > 0 %}
            <div class="grid3">
              {% for a in group.agencies %}
                <div class="agency">
                  <h3><a href="/umrah_operators/{{ a.registration_id }}">{{ a.agencies_name }}</a></h3>
                  <div class="meta">
                    {{ a.city or (a.city_rel.name if a.city_rel else '—') }}, {{ a.country or '—' }}
                  </div>
                  {% if a.description %}<div class="desc">{{ a.description }}</div>{% endif %}
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="empty">No operators in {{ group.city }}.</div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card"><div class="empty">No operators available yet.</div></div>
  {% endif %}
</div>
{% endblock %}
