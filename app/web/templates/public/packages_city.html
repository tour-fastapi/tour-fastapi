{% extends "base.html" %}
{% block title %}Packages in {{ city }}{% endblock %}
{% block content %}
{% import "shared/_macros.html" as ui %}


<main class="page">
  
  <header class="page-header">
    <a class="page-back" href="/umrah_packages">
      ← Back to packages
    </a>

    <div class="page-title-wrap">
      <div class="page-title-group">
        <h1 class="page-title">
          Umrah Packages in {{ city }}
        </h1>

        <p class="page-subtitle">
          Available Umrah packages departing from {{ city }}
        </p>
      </div>

      <span class="page-count">
        {{ count }} package{{ 's' if count != 1 else '' }}
      </span>
    </div>
  </header>


  {% if packages and packages|length > 0 %}
  <section class="package-list">
    {% for p in packages %}
      {% set ag = agency_by_id.get(p.registration_id) %}
      {% set href = "/umrah_packages/" ~ p.package_id %}

      <a class="package-card entity-card" href="{{ href }}">  
        <!-- Agency avatar (same logic as operators) -->
         
        <div
          class="package-avatar operator-avatar"
          data-tone="{{ (loop.index0 + (ag.agencies_name|length if ag else 0)) % 12 }}"
        >
          {% if ag %}
            {{ ui.agency_badge(ag, 56, True) }}
          {% endif %}
        </div>

        <div class="package-body">
          <h2 class="package-name">
            {{ p.package_name }}
          </h2>

          <p class="package-location">
            {{ ag.city if ag and ag.city else '—' }}, {{ ag.country if ag and ag.country else '—' }}
          </p>

          <div class="package-meta">
            {% if p.days %}<span class="meta-chip">{{ p.days }} day{{ 's' if p.days != 1 else '' }}</span>{% endif %}
            {% if p.price is not none %}<span class="meta-chip">From ₹ {{ '%0.0f'|format(p.price) }}</span>{% endif %}
            {% if ag and ag.agencies_name %}<span class="meta-chip">{{ ag.agencies_name }}</span>{% endif %}
          </div>

          {% if p.description %}
            <p class="package-description">{{ p.description }}</p>
          {% endif %}
        </div>
      </a>
    {% endfor %}
  </section>
{% else %}
  <div class="empty-state">No packages found in {{ city }}.</div>
{% endif %}

</main>
{% endblock %}
